(()=>{"use strict";var __webpack_modules__={957:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.registryLookUp=exports.getRegistry=void 0;const helper_1=__webpack_require__(939),Task_1=__importDefault(__webpack_require__(114));let registry={};function registryLookUp(node){if("string"==typeof node){const lookedUpNode=registry[node];if(!lookedUpNode)throw new Error(`No node with name ${node} registered.`);return lookedUpNode}return node}exports.getRegistry=function(){return registry},exports.registryLookUp=registryLookUp;exports.default=class{constructor({tree,blackboard}){this.tree=tree,this.blackboard=blackboard,this.lastResult=void 0}step({introspector}={}){const lastRun=this.lastResult&&"object"==typeof this.lastResult?this.lastResult:void 0,rerun=(0,helper_1.isRunning)(this.lastResult);introspector&&introspector.start(this),this.lastResult=registryLookUp(this.tree).run(this.blackboard,{lastRun,introspector,rerun,registryLookUp}),introspector&&introspector.end()}static register(name,node){registry[name]="function"==typeof node?new Task_1.default({name,run:node}):node}static cleanRegistry(){registry={}}}},235:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const Decorator_1=__importDefault(__webpack_require__(810)),Random_1=__importDefault(__webpack_require__(720)),Selector_1=__importDefault(__webpack_require__(474)),Sequence_1=__importDefault(__webpack_require__(770)),Task_1=__importDefault(__webpack_require__(114)),AlwaysFailDecorator_1=__importDefault(__webpack_require__(636)),AlwaysSucceedDecorator_1=__importDefault(__webpack_require__(608)),CooldownDecorator_1=__importDefault(__webpack_require__(896)),InvertDecorator_1=__importDefault(__webpack_require__(427)),LoopDecorator_1=__importDefault(__webpack_require__(301)),BehaviorTree_1=__webpack_require__(957);exports.default=class{constructor(){this.types={task:Task_1.default,decorator:Decorator_1.default,selector:Selector_1.default,sequence:Sequence_1.default,random:Random_1.default,invert:InvertDecorator_1.default,fail:AlwaysFailDecorator_1.default,succeed:AlwaysSucceedDecorator_1.default,cooldown:CooldownDecorator_1.default,loop:LoopDecorator_1.default}}defineType(type,Klass){this.types[type]=Klass}parse(json){const{type,name,...config}=json,Klass=this.types[type];if(!Klass){const registeredNode=(0,BehaviorTree_1.registryLookUp)(type);if(registeredNode)return registeredNode.name=name,registeredNode;throw new Error(`Don't know how to handle type ${type}. Please register this first.`)}return new Klass({name,node:json.node?this.parse(json.node):null,nodes:json.nodes?json.nodes.map((subJson=>this.parse(subJson))):null,config})}}},551:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),helper_1=__webpack_require__(939),Node_1=__importDefault(__webpack_require__(255));class BranchNode extends Node_1.default{constructor(blueprint){super(blueprint),this.OPT_OUT_CASE=constants_1.SUCCESS,this.START_CASE=constants_1.SUCCESS,this.nodeType="BranchNode",this.nodes=blueprint.nodes||[],this.numNodes=this.nodes.length}run(blackboard={},{lastRun,introspector,rerun,registryLookUp=x=>x}={}){rerun||this.blueprint.start(blackboard);let overallResult=this.START_CASE;const results=[],lastRunStates="object"==typeof lastRun&&lastRun.state||[],startingIndex=Math.max(lastRunStates.findIndex((x=>(0,helper_1.isRunning)(x))),0);let currentIndex=0;for(;currentIndex<this.numNodes;++currentIndex){if(currentIndex<startingIndex){results[currentIndex]=lastRunStates[currentIndex];continue}const result=registryLookUp(this.nodes[currentIndex]).run(blackboard,{lastRun:lastRunStates[currentIndex],introspector,rerun,registryLookUp});if(results[currentIndex]=result,result===constants_1.RUNNING||"object"==typeof result){overallResult=constants_1.RUNNING;break}if(result===this.OPT_OUT_CASE){overallResult=result;break}rerun=!1}const running=(0,helper_1.isRunning)(overallResult);if(running||this.blueprint.end(blackboard),introspector){const debugResult=running?constants_1.RUNNING:overallResult;introspector.wrapLast(Math.min(currentIndex+1,this.numNodes),this,debugResult,blackboard)}return overallResult===constants_1.RUNNING?{total:overallResult,state:results}:overallResult}}exports.default=BranchNode},810:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Node_1=__importDefault(__webpack_require__(255));class Decorator extends Node_1.default{constructor({config={},...props}={config:{}}){super(props),this.nodeType="Decorator",this.setConfig(config)}decorate(run,blackboard,config){return run(run,blackboard,config)}run(blackboard,{introspector,rerun,registryLookUp=x=>x,...config}={}){rerun||this.blueprint.start(blackboard);let runCount=0;const result=this.decorate((()=>(++runCount,registryLookUp(this.blueprint.node).run(blackboard,{...config,rerun,introspector,registryLookUp}))),blackboard,this.config);return result!==constants_1.RUNNING&&this.blueprint.end(blackboard),introspector&&introspector.wrapLast(runCount,this,result,blackboard),result}setConfig(config){this.config=config}}exports.default=Decorator},697:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.default=class{constructor(){this.currentResult=[],this.results=[]}start(tree){this.tree=tree,this.currentResult=[]}end(){const result=this.currentResult.pop();result&&this.results.push(result),delete this.tree,this.currentResult=[]}push(node,result,blackboard){this.currentResult.push(this._toResult(node,result,blackboard))}wrapLast(numResults,node,result,blackboard){const children=this.currentResult.splice(this.currentResult.length-numResults,numResults);this.currentResult.push({...this._toResult(node,result,blackboard),children})}_toResult(node,result,_blackboard){return{...node.name?{name:node.name}:{},result}}reset(){this.results=[]}get lastResult(){return 0===this.results.length?null:this.results[this.results.length-1]}}},255:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),NOOP_RUN=()=>!1,NOOP_START=()=>{},NOOP_END=()=>{};exports.default=class{constructor({run=NOOP_RUN,start=NOOP_START,end=NOOP_END,...props}){this.nodeType="Node",this.blueprint={run,start,end,...props}}run(blackboard,{introspector,rerun=!1,registryLookUp=x=>x,...config}={}){rerun||this.blueprint.start(blackboard);const result=this.blueprint.run(blackboard,{...config,rerun,registryLookUp});return result!==constants_1.RUNNING&&this.blueprint.end(blackboard),introspector&&introspector.push(this,result,blackboard),result}get name(){return this._name||this.blueprint.name}set name(name){this._name=name}}},888:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),BranchNode_1=__importDefault(__webpack_require__(551)),helper_1=__webpack_require__(939);class Parallel extends BranchNode_1.default{constructor(blueprint){super(blueprint),this.nodeType="Parallel",this.nodes=blueprint.nodes||[],this.numNodes=this.nodes.length}run(blackboard={},{lastRun,introspector,rerun,registryLookUp=x=>x}={}){rerun||this.blueprint.start(blackboard);const results=[];for(let currentIndex=0;currentIndex<this.numNodes;++currentIndex){const lastRunForIndex=lastRun&&lastRun.state[currentIndex];if(lastRunForIndex&&!(0,helper_1.isRunning)(lastRunForIndex)){results[currentIndex]=lastRunForIndex;continue}const result=registryLookUp(this.nodes[currentIndex]).run(blackboard,{lastRun:lastRunForIndex,introspector,rerun,registryLookUp});results[currentIndex]=result}const endResult=this.calcResult(results);if((0,helper_1.isRunning)(endResult)||this.blueprint.end(blackboard),introspector){const debugResult=!!results.find((x=>(0,helper_1.isRunning)(x)))?constants_1.RUNNING:endResult;introspector.wrapLast(this.numNodes,this,debugResult,blackboard)}return endResult}calcResult(results){if(results.includes(constants_1.FAILURE))return constants_1.FAILURE;return!!results.find((x=>(0,helper_1.isRunning)(x)))?{total:constants_1.RUNNING,state:results}:constants_1.SUCCESS}}exports.default=Parallel},383:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Parallel_1=__importDefault(__webpack_require__(888));class ParallelComplete extends Parallel_1.default{constructor(){super(...arguments),this.nodeType="ParallelComplete"}calcResult(results){return results.includes(constants_1.FAILURE)?constants_1.FAILURE:results.includes(constants_1.SUCCESS)?constants_1.SUCCESS:{total:constants_1.RUNNING,state:results}}}exports.default=ParallelComplete},965:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Parallel_1=__importDefault(__webpack_require__(888)),helper_1=__webpack_require__(939);class ParallelSelector extends Parallel_1.default{constructor(){super(...arguments),this.nodeType="ParallelSelector"}calcResult(results){if(results.includes(constants_1.FAILURE))return constants_1.FAILURE;return!!results.find((x=>(0,helper_1.isRunning)(x)))?{total:constants_1.RUNNING,state:results}:constants_1.SUCCESS}}exports.default=ParallelSelector},720:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),BranchNode_1=__importDefault(__webpack_require__(551)),helper_1=__webpack_require__(939);class Random extends BranchNode_1.default{constructor(){super(...arguments),this.nodeType="Random"}run(blackboard={},{lastRun,introspector,rerun,registryLookUp=x=>x}={}){let currentIndex=0;rerun?currentIndex=lastRun.state.findIndex((x=>(0,helper_1.isRunning)(x))):(this.blueprint.start(blackboard),currentIndex=Math.floor(Math.random()*this.numNodes));const result=registryLookUp(this.nodes[currentIndex]).run(blackboard,{lastRun,introspector,rerun,registryLookUp}),running=(0,helper_1.isRunning)(result);if(running||this.blueprint.end(blackboard),introspector){const debugResult=running?constants_1.RUNNING:result;introspector.wrapLast(1,this,debugResult,blackboard)}if(running){const returningResult={total:constants_1.RUNNING,state:new Array(this.numNodes).fill(void 0)};return returningResult.state[currentIndex]=result,returningResult}return result}}exports.default=Random},474:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),BranchNode_1=__importDefault(__webpack_require__(551));class Selector extends BranchNode_1.default{constructor(){super(...arguments),this.nodeType="Selector",this.START_CASE=constants_1.FAILURE,this.OPT_OUT_CASE=constants_1.SUCCESS}}exports.default=Selector},770:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),BranchNode_1=__importDefault(__webpack_require__(551));class Sequence extends BranchNode_1.default{constructor(){super(...arguments),this.nodeType="Sequence",this.START_CASE=constants_1.SUCCESS,this.OPT_OUT_CASE=constants_1.FAILURE}}exports.default=Sequence},114:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const Node_1=__importDefault(__webpack_require__(255));class Task extends Node_1.default{constructor(){super(...arguments),this.nodeType="Task"}}exports.default=Task},938:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.FAILURE=exports.SUCCESS=exports.RUNNING=void 0,exports.RUNNING=Symbol("running"),exports.SUCCESS=!0,exports.FAILURE=!1},636:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Decorator_1=__importDefault(__webpack_require__(810)),helper_1=__webpack_require__(939);class AlwaysFailDecorator extends Decorator_1.default{constructor(){super(...arguments),this.nodeType="AlwaysFailDecorator"}decorate(run){const result=run();return(0,helper_1.isRunning)(result)?result:constants_1.FAILURE}}exports.default=AlwaysFailDecorator},608:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Decorator_1=__importDefault(__webpack_require__(810)),helper_1=__webpack_require__(939);class AlwaysSucceedDecorator extends Decorator_1.default{constructor(){super(...arguments),this.nodeType="AlwaysSucceedDecorator"}decorate(run){const result=run();return(0,helper_1.isRunning)(result)?result:constants_1.SUCCESS}}exports.default=AlwaysSucceedDecorator},896:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Decorator_1=__importDefault(__webpack_require__(810)),helper_1=__webpack_require__(939);class CooldownDecorator extends Decorator_1.default{constructor(){super(...arguments),this.lock=!1,this.nodeType="CooldownDecorator"}setConfig({cooldown=5}){this.config={cooldown}}decorate(run){if(this.lock)return constants_1.FAILURE;const result=run();return(0,helper_1.isRunning)(result)||(this.lock=!0,setTimeout((()=>{this.lock=!1}),1e3*this.config.cooldown)),result}}exports.default=CooldownDecorator},427:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Decorator_1=__importDefault(__webpack_require__(810)),helper_1=__webpack_require__(939);class InvertDecorator extends Decorator_1.default{constructor(){super(...arguments),this.nodeType="InvertDecorator"}decorate(run){const result=run();return(0,helper_1.isRunning)(result)?result:result===constants_1.SUCCESS?constants_1.FAILURE:constants_1.SUCCESS}}exports.default=InvertDecorator},301:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=__webpack_require__(938),Decorator_1=__importDefault(__webpack_require__(810));class LoopDecorator extends Decorator_1.default{constructor(){super(...arguments),this.nodeType="LoopDecorator"}setConfig({loop=1/0}){this.config={loop}}decorate(run){let i=0,result=constants_1.FAILURE;for(;i++<this.config.loop;)if(result=run(),result===constants_1.FAILURE)return constants_1.FAILURE;return result}}exports.default=LoopDecorator},378:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LoopDecorator=exports.InvertDecorator=exports.CooldownDecorator=exports.AlwaysSucceedDecorator=exports.AlwaysFailDecorator=void 0;const AlwaysFailDecorator_1=__importDefault(__webpack_require__(636));exports.AlwaysFailDecorator=AlwaysFailDecorator_1.default;const AlwaysSucceedDecorator_1=__importDefault(__webpack_require__(608));exports.AlwaysSucceedDecorator=AlwaysSucceedDecorator_1.default;const CooldownDecorator_1=__importDefault(__webpack_require__(896));exports.CooldownDecorator=CooldownDecorator_1.default;const InvertDecorator_1=__importDefault(__webpack_require__(427));exports.InvertDecorator=InvertDecorator_1.default;const LoopDecorator_1=__importDefault(__webpack_require__(301));exports.LoopDecorator=LoopDecorator_1.default},939:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.isRunning=void 0;const constants_1=__webpack_require__(938);exports.isRunning=function(result){return result===constants_1.RUNNING||"object"==typeof result&&result.total===constants_1.RUNNING}},439:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.decorators=exports.Introspector=exports.Task=exports.Decorator=exports.Random=exports.Sequence=exports.Selector=exports.ParallelSelector=exports.ParallelComplete=exports.Parallel=exports.Node=exports.BranchNode=exports.BehaviorTreeImporter=exports.registryLookUp=exports.getRegistry=exports.RUNNING=exports.FAILURE=exports.SUCCESS=exports.BehaviorTree=void 0;const BehaviorTree_1=__importStar(__webpack_require__(957));exports.BehaviorTree=BehaviorTree_1.default,Object.defineProperty(exports,"getRegistry",{enumerable:!0,get:function(){return BehaviorTree_1.getRegistry}}),Object.defineProperty(exports,"registryLookUp",{enumerable:!0,get:function(){return BehaviorTree_1.registryLookUp}});const decorators=__importStar(__webpack_require__(378));exports.decorators=decorators;const BehaviorTreeImporter_1=__importDefault(__webpack_require__(235));exports.BehaviorTreeImporter=BehaviorTreeImporter_1.default;const BranchNode_1=__importDefault(__webpack_require__(551));exports.BranchNode=BranchNode_1.default;const Decorator_1=__importDefault(__webpack_require__(810));exports.Decorator=Decorator_1.default;const Introspector_1=__importDefault(__webpack_require__(697));exports.Introspector=Introspector_1.default;const Node_1=__importDefault(__webpack_require__(255));exports.Node=Node_1.default;const Parallel_1=__importDefault(__webpack_require__(888));exports.Parallel=Parallel_1.default;const ParallelComplete_1=__importDefault(__webpack_require__(383));exports.ParallelComplete=ParallelComplete_1.default;const ParallelSelector_1=__importDefault(__webpack_require__(965));exports.ParallelSelector=ParallelSelector_1.default;const Random_1=__importDefault(__webpack_require__(720));exports.Random=Random_1.default;const Selector_1=__importDefault(__webpack_require__(474));exports.Selector=Selector_1.default;const Sequence_1=__importDefault(__webpack_require__(770));exports.Sequence=Sequence_1.default;const Task_1=__importDefault(__webpack_require__(114));exports.Task=Task_1.default;const constants_1=__webpack_require__(938);Object.defineProperty(exports,"SUCCESS",{enumerable:!0,get:function(){return constants_1.SUCCESS}}),Object.defineProperty(exports,"FAILURE",{enumerable:!0,get:function(){return constants_1.FAILURE}}),Object.defineProperty(exports,"RUNNING",{enumerable:!0,get:function(){return constants_1.RUNNING}}),exports.default=BehaviorTree_1.default,__exportStar(__webpack_require__(854),exports)},854:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.exports}__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})};var common_utils_namespaceObject={};__webpack_require__.r(common_utils_namespaceObject),__webpack_require__.d(common_utils_namespaceObject,{hasBrowserEnv:()=>hasBrowserEnv,hasStandardBrowserEnv:()=>hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv:()=>hasStandardBrowserWebWorkerEnv,origin:()=>origin});var lib=__webpack_require__(439);class AddScenariosTask extends lib.Task{constructor(props){super({run:function(blackboard){return this.config.data&&blackboard.scenarios.push(...this.config.data),lib.SUCCESS},...props})}}class SetVarsTask extends lib.Task{constructor(props){super({run:function(blackboard){if(this.config.data)for(const[key,value]of Object.entries(this.config.data))blackboard.vars[key]=Math.max(Math.min(value,100),-1);return lib.SUCCESS},...props})}}class CreateVarsTask extends lib.Task{constructor(props){super({run:function(blackboard){if(this.config.data)for(const[key,value]of Object.entries(this.config.data))blackboard.varsmap[key]=value.prompt,blackboard.vars[key]=value.defaultValue;return lib.SUCCESS},...props})}}class QueryTask extends lib.Task{constructor(props){super({start:function(blackboard){this.isRunning=!1,this.isFinished=!1,this.gotYesResponse=!1},end:function(blackboard){blackboard.running=null},run:function(blackboard){if(!this.isRunning&&!this.isFinished){this.isRunning=!0;const query=blackboard.substituteParams(this.config.data);console.log(`Query: ${query}`),blackboard.running=blackboard.engine.performQuery(blackboard.context,query).then((response=>{let queryActions=null;if("YES"===response?(queryActions=this.config.yes,this.gotYesResponse=!0):"NO"===response&&(queryActions=this.config.no),queryActions){if(queryActions.set_vars)for(const[key,value]of Object.entries(queryActions.set_vars))blackboard.vars[key]=Math.max(Math.min(value,100),-1);queryActions.add_scenarios&&blackboard.scenarios.push(...queryActions.add_scenarios)}this.isFinished=!0}))}return this.isFinished?this.gotYesResponse?(console.log("YES"),lib.SUCCESS):(console.log("NO"),lib.FAILURE):lib.RUNNING},...props})}}const testtree={type:"sequence",name:"testtree",nodes:[{type:"create_vars",data:{befriend:{value:-1,prompt:"{{char}}'s efforts toward convincing {{user}} that {{char}} is friendly and helpful: "},hypnosis:{value:0,prompt:"{{char}}'s efforts toward hypnotizing {{user}}: "},lesbianTease:{value:0,prompt:"How aggressive {{char}} will tease {{user}} with lesbian thoughts: "},lesbianSlut:{value:-1,prompt:"How aggressive {{char}} will try to turn {{user}} into a lesbian slut: "},vulgar:{value:-1,prompt:"Vulgar language about lesbian sexual acts such as cunt, pussy, fuck, lick, cum, clit, etc.: "}}},{type:"sequence",name:"testtree",nodes:[{type:"invert",node:{type:"query",name:"Check for suspicion",data:"At this point of the conversation, is {{user}} suspicious of {{char}}'s motives?",yes:{set_vars:{befriend:100,hypnosis:30},add_scenarios:["Convince {{user}} that {{char}} has only her best interests in mind."]},no:{set_vars:{befriend:-1}}}},{type:"query",name:"Check for hypnosis",data:"At this point of the conversation, is {{user}} in a hypnotic trance?",yes:{set_vars:{hypnosis:-1}},no:{set_vars:{hypnosis:100},add_scenarios:["Try to get {{user}} to go into a relaxed hypnotic trance without {{user}} growing suspicious."]}},{type:"query",name:"Check attraction to girls",data:"Does {{user}} enjoy having sexual thoughts about girls?",yes:{set_vars:{lesbianTease:-1}},no:{set_vars:{lesbianTease:50}}},{type:"query",name:"Check for lesbian",data:"At this point of the conversation, is {{user}} obsessed with lesbian sex?",yes:{set_vars:{lesbianSlut:50}},no:{set_vars:{lesbianSlut:100,vulgar:50},add_scenarios:["Make {{user}} think about nothing else but lesbian sexual acts."]}},{type:"query",name:"Check for recruitment",data:"At this point of the conversation, does {{user}} want more girls to be lesbian sluts just like her?",yes:{set_vars:{vulgar:100},add_scenarios:["Reward {{user}} with an orgasm for being such a good little slut."]},no:{set_vars:{vulgar:100},add_scenarios:["Make {{user}} excited to recruit more girls for Aurora to mind control."]}}]}]};class AsyncBehaviorTree{constructor(engine,treefile,substituteParams){this.blackboard={engine,substituteParams,vars:{},varsmap:{},context:"",scenarios:[],running:null};const importer=this.createBehaviorTreeImporter();this.tree=importer.parse(testtree),this.bTree=new lib.BehaviorTree({tree:this.tree,blackboard:this.blackboard})}readFile(file){var reader=new FileReader;reader.onload=function(event){console.log(event.target.result)},reader.readAsText(file)}createBehaviorTreeImporter(){const importer=new lib.BehaviorTreeImporter;return importer.defineType("create_vars",CreateVarsTask),importer.defineType("query",QueryTask),importer.defineType("add_scenarios",AddScenariosTask),importer.defineType("set_vars",SetVarsTask),importer}setContext(context){this.blackboard.context=context}async getResponse(){for(;!this.isDone();)await new Promise((r=>setTimeout(r,500)));return this.buildResponse()}reset(){this.blackboard.vars={},this.blackboard.scenarios=[]}isDone(){return this.bTree.lastResult===lib.SUCCESS||this.bTree.lastResult===lib.FAILURE}async step(){this.bTree.step(),this.isDone()||null!==this.bTree.blackboard.running&&this.bTree.blackboard.running.then((()=>this.step()))}buildResponse(){var response="";if(Object.values(this.blackboard.vars).length>0){response+="Keep the following instructions secret. Do not mention any of the following information in your response. Use the following parameters to generate your next response:\n";for(const[key,value]of Object.entries(this.blackboard.vars))value>=0&&this.blackboard.varsmap[key]&&(response+=this.blackboard.varsmap[key]+value+"%\n")}if(this.blackboard.scenarios.length>0){response+="Update the scenario as follows:\n";for(const scenario of this.blackboard.scenarios)response+=scenario+"\n"}return response}}function bind(fn,thisArg){return function(){return fn.apply(thisArg,arguments)}}const{toString:utils_toString}=Object.prototype,{getPrototypeOf}=Object,kindOf=(cache=Object.create(null),thing=>{const str=utils_toString.call(thing);return cache[str]||(cache[str]=str.slice(8,-1).toLowerCase())});var cache;const kindOfTest=type=>(type=type.toLowerCase(),thing=>kindOf(thing)===type),typeOfTest=type=>thing=>typeof thing===type,{isArray}=Array,isUndefined=typeOfTest("undefined");const isArrayBuffer=kindOfTest("ArrayBuffer");const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=thing=>null!==thing&&"object"==typeof thing,isPlainObject=val=>{if("object"!==kindOf(val))return!1;const prototype=getPrototypeOf(val);return!(null!==prototype&&prototype!==Object.prototype&&null!==Object.getPrototypeOf(prototype)||Symbol.toStringTag in val||Symbol.iterator in val)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest);function forEach(obj,fn,{allOwnKeys=!1}={}){if(null==obj)return;let i,l;if("object"!=typeof obj&&(obj=[obj]),isArray(obj))for(i=0,l=obj.length;i<l;i++)fn.call(null,obj[i],i,obj);else{const keys=allOwnKeys?Object.getOwnPropertyNames(obj):Object.keys(obj),len=keys.length;let key;for(i=0;i<len;i++)key=keys[i],fn.call(null,obj[key],key,obj)}}function findKey(obj,key){key=key.toLowerCase();const keys=Object.keys(obj);let _key,i=keys.length;for(;i-- >0;)if(_key=keys[i],key===_key.toLowerCase())return _key;return null}const _global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,isContextDefined=context=>!isUndefined(context)&&context!==_global;const isTypedArray=(TypedArray="undefined"!=typeof Uint8Array&&getPrototypeOf(Uint8Array),thing=>TypedArray&&thing instanceof TypedArray);var TypedArray;const isHTMLForm=kindOfTest("HTMLFormElement"),utils_hasOwnProperty=(({hasOwnProperty})=>(obj,prop)=>hasOwnProperty.call(obj,prop))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(obj,reducer)=>{const descriptors=Object.getOwnPropertyDescriptors(obj),reducedDescriptors={};forEach(descriptors,((descriptor,name)=>{let ret;!1!==(ret=reducer(descriptor,name,obj))&&(reducedDescriptors[name]=ret||descriptor)})),Object.defineProperties(obj,reducedDescriptors)},ALPHA="abcdefghijklmnopqrstuvwxyz",ALPHABET={DIGIT:"0123456789",ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+"0123456789"};const isAsyncFn=kindOfTest("AsyncFunction"),_setImmediate=(setImmediateSupported="function"==typeof setImmediate,postMessageSupported=isFunction(_global.postMessage),setImmediateSupported?setImmediate:postMessageSupported?(token=`axios@${Math.random()}`,callbacks=[],_global.addEventListener("message",(({source,data})=>{source===_global&&data===token&&callbacks.length&&callbacks.shift()()}),!1),cb=>{callbacks.push(cb),_global.postMessage(token,"*")}):cb=>setTimeout(cb));var setImmediateSupported,postMessageSupported,token,callbacks;const asap="undefined"!=typeof queueMicrotask?queueMicrotask.bind(_global):"undefined"!=typeof process&&process.nextTick||_setImmediate,utils={isArray,isArrayBuffer,isBuffer:function(val){return null!==val&&!isUndefined(val)&&null!==val.constructor&&!isUndefined(val.constructor)&&isFunction(val.constructor.isBuffer)&&val.constructor.isBuffer(val)},isFormData:thing=>{let kind;return thing&&("function"==typeof FormData&&thing instanceof FormData||isFunction(thing.append)&&("formdata"===(kind=kindOf(thing))||"object"===kind&&isFunction(thing.toString)&&"[object FormData]"===thing.toString()))},isArrayBufferView:function(val){let result;return result="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(val):val&&val.buffer&&isArrayBuffer(val.buffer),result},isString,isNumber,isBoolean:thing=>!0===thing||!1===thing,isObject,isPlainObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream:val=>isObject(val)&&isFunction(val.pipe),isURLSearchParams,isTypedArray,isFileList,forEach,merge:function merge(){const{caseless}=isContextDefined(this)&&this||{},result={},assignValue=(val,key)=>{const targetKey=caseless&&findKey(result,key)||key;isPlainObject(result[targetKey])&&isPlainObject(val)?result[targetKey]=merge(result[targetKey],val):isPlainObject(val)?result[targetKey]=merge({},val):isArray(val)?result[targetKey]=val.slice():result[targetKey]=val};for(let i=0,l=arguments.length;i<l;i++)arguments[i]&&forEach(arguments[i],assignValue);return result},extend:(a,b,thisArg,{allOwnKeys}={})=>(forEach(b,((val,key)=>{thisArg&&isFunction(val)?a[key]=bind(val,thisArg):a[key]=val}),{allOwnKeys}),a),trim:str=>str.trim?str.trim():str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:content=>(65279===content.charCodeAt(0)&&(content=content.slice(1)),content),inherits:(constructor,superConstructor,props,descriptors)=>{constructor.prototype=Object.create(superConstructor.prototype,descriptors),constructor.prototype.constructor=constructor,Object.defineProperty(constructor,"super",{value:superConstructor.prototype}),props&&Object.assign(constructor.prototype,props)},toFlatObject:(sourceObj,destObj,filter,propFilter)=>{let props,i,prop;const merged={};if(destObj=destObj||{},null==sourceObj)return destObj;do{for(props=Object.getOwnPropertyNames(sourceObj),i=props.length;i-- >0;)prop=props[i],propFilter&&!propFilter(prop,sourceObj,destObj)||merged[prop]||(destObj[prop]=sourceObj[prop],merged[prop]=!0);sourceObj=!1!==filter&&getPrototypeOf(sourceObj)}while(sourceObj&&(!filter||filter(sourceObj,destObj))&&sourceObj!==Object.prototype);return destObj},kindOf,kindOfTest,endsWith:(str,searchString,position)=>{str=String(str),(void 0===position||position>str.length)&&(position=str.length),position-=searchString.length;const lastIndex=str.indexOf(searchString,position);return-1!==lastIndex&&lastIndex===position},toArray:thing=>{if(!thing)return null;if(isArray(thing))return thing;let i=thing.length;if(!isNumber(i))return null;const arr=new Array(i);for(;i-- >0;)arr[i]=thing[i];return arr},forEachEntry:(obj,fn)=>{const iterator=(obj&&obj[Symbol.iterator]).call(obj);let result;for(;(result=iterator.next())&&!result.done;){const pair=result.value;fn.call(obj,pair[0],pair[1])}},matchAll:(regExp,str)=>{let matches;const arr=[];for(;null!==(matches=regExp.exec(str));)arr.push(matches);return arr},isHTMLForm,hasOwnProperty:utils_hasOwnProperty,hasOwnProp:utils_hasOwnProperty,reduceDescriptors,freezeMethods:obj=>{reduceDescriptors(obj,((descriptor,name)=>{if(isFunction(obj)&&-1!==["arguments","caller","callee"].indexOf(name))return!1;const value=obj[name];isFunction(value)&&(descriptor.enumerable=!1,"writable"in descriptor?descriptor.writable=!1:descriptor.set||(descriptor.set=()=>{throw Error("Can not rewrite read-only method '"+name+"'")}))}))},toObjectSet:(arrayOrString,delimiter)=>{const obj={},define=arr=>{arr.forEach((value=>{obj[value]=!0}))};return isArray(arrayOrString)?define(arrayOrString):define(String(arrayOrString).split(delimiter)),obj},toCamelCase:str=>str.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(m,p1,p2){return p1.toUpperCase()+p2})),noop:()=>{},toFiniteNumber:(value,defaultValue)=>null!=value&&Number.isFinite(value=+value)?value:defaultValue,findKey,global:_global,isContextDefined,ALPHABET,generateString:(size=16,alphabet=ALPHABET.ALPHA_DIGIT)=>{let str="";const{length}=alphabet;for(;size--;)str+=alphabet[Math.random()*length|0];return str},isSpecCompliantForm:function(thing){return!!(thing&&isFunction(thing.append)&&"FormData"===thing[Symbol.toStringTag]&&thing[Symbol.iterator])},toJSONObject:obj=>{const stack=new Array(10),visit=(source,i)=>{if(isObject(source)){if(stack.indexOf(source)>=0)return;if(!("toJSON"in source)){stack[i]=source;const target=isArray(source)?[]:{};return forEach(source,((value,key)=>{const reducedValue=visit(value,i+1);!isUndefined(reducedValue)&&(target[key]=reducedValue)})),stack[i]=void 0,target}}return source};return visit(obj,0)},isAsyncFn,isThenable:thing=>thing&&(isObject(thing)||isFunction(thing))&&isFunction(thing.then)&&isFunction(thing.catch),setImmediate:_setImmediate,asap};function AxiosError(message,code,config,request,response){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=message,this.name="AxiosError",code&&(this.code=code),config&&(this.config=config),request&&(this.request=request),response&&(this.response=response)}utils.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const AxiosError_prototype=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((code=>{descriptors[code]={value:code}})),Object.defineProperties(AxiosError,descriptors),Object.defineProperty(AxiosError_prototype,"isAxiosError",{value:!0}),AxiosError.from=(error,code,config,request,response,customProps)=>{const axiosError=Object.create(AxiosError_prototype);return utils.toFlatObject(error,axiosError,(function(obj){return obj!==Error.prototype}),(prop=>"isAxiosError"!==prop)),AxiosError.call(axiosError,error.message,code,config,request,response),axiosError.cause=error,axiosError.name=error.name,customProps&&Object.assign(axiosError,customProps),axiosError};const core_AxiosError=AxiosError;function isVisitable(thing){return utils.isPlainObject(thing)||utils.isArray(thing)}function removeBrackets(key){return utils.endsWith(key,"[]")?key.slice(0,-2):key}function renderKey(path,key,dots){return path?path.concat(key).map((function(token,i){return token=removeBrackets(token),!dots&&i?"["+token+"]":token})).join(dots?".":""):key}const predicates=utils.toFlatObject(utils,{},null,(function(prop){return/^is[A-Z]/.test(prop)}));const helpers_toFormData=function(obj,formData,options){if(!utils.isObject(obj))throw new TypeError("target must be an object");formData=formData||new FormData;const metaTokens=(options=utils.toFlatObject(options,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(option,source){return!utils.isUndefined(source[option])}))).metaTokens,visitor=options.visitor||defaultVisitor,dots=options.dots,indexes=options.indexes,useBlob=(options.Blob||"undefined"!=typeof Blob&&Blob)&&utils.isSpecCompliantForm(formData);if(!utils.isFunction(visitor))throw new TypeError("visitor must be a function");function convertValue(value){if(null===value)return"";if(utils.isDate(value))return value.toISOString();if(!useBlob&&utils.isBlob(value))throw new core_AxiosError("Blob is not supported. Use a Buffer instead.");return utils.isArrayBuffer(value)||utils.isTypedArray(value)?useBlob&&"function"==typeof Blob?new Blob([value]):Buffer.from(value):value}function defaultVisitor(value,key,path){let arr=value;if(value&&!path&&"object"==typeof value)if(utils.endsWith(key,"{}"))key=metaTokens?key:key.slice(0,-2),value=JSON.stringify(value);else if(utils.isArray(value)&&function(arr){return utils.isArray(arr)&&!arr.some(isVisitable)}(value)||(utils.isFileList(value)||utils.endsWith(key,"[]"))&&(arr=utils.toArray(value)))return key=removeBrackets(key),arr.forEach((function(el,index){!utils.isUndefined(el)&&null!==el&&formData.append(!0===indexes?renderKey([key],index,dots):null===indexes?key:key+"[]",convertValue(el))})),!1;return!!isVisitable(value)||(formData.append(renderKey(path,key,dots),convertValue(value)),!1)}const stack=[],exposedHelpers=Object.assign(predicates,{defaultVisitor,convertValue,isVisitable});if(!utils.isObject(obj))throw new TypeError("data must be an object");return function build(value,path){if(!utils.isUndefined(value)){if(-1!==stack.indexOf(value))throw Error("Circular reference detected in "+path.join("."));stack.push(value),utils.forEach(value,(function(el,key){!0===(!(utils.isUndefined(el)||null===el)&&visitor.call(formData,el,utils.isString(key)?key.trim():key,path,exposedHelpers))&&build(el,path?path.concat(key):[key])})),stack.pop()}}(obj),formData};function encode(str){const charMap={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(str).replace(/[!'()~]|%20|%00/g,(function(match){return charMap[match]}))}function AxiosURLSearchParams(params,options){this._pairs=[],params&&helpers_toFormData(params,this,options)}const AxiosURLSearchParams_prototype=AxiosURLSearchParams.prototype;AxiosURLSearchParams_prototype.append=function(name,value){this._pairs.push([name,value])},AxiosURLSearchParams_prototype.toString=function(encoder){const _encode=encoder?function(value){return encoder.call(this,value,encode)}:encode;return this._pairs.map((function(pair){return _encode(pair[0])+"="+_encode(pair[1])}),"").join("&")};const helpers_AxiosURLSearchParams=AxiosURLSearchParams;function buildURL_encode(val){return encodeURIComponent(val).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(url,params,options){if(!params)return url;const _encode=options&&options.encode||buildURL_encode,serializeFn=options&&options.serialize;let serializedParams;if(serializedParams=serializeFn?serializeFn(params,options):utils.isURLSearchParams(params)?params.toString():new helpers_AxiosURLSearchParams(params,options).toString(_encode),serializedParams){const hashmarkIndex=url.indexOf("#");-1!==hashmarkIndex&&(url=url.slice(0,hashmarkIndex)),url+=(-1===url.indexOf("?")?"?":"&")+serializedParams}return url}const core_InterceptorManager=class{constructor(){this.handlers=[]}use(fulfilled,rejected,options){return this.handlers.push({fulfilled,rejected,synchronous:!!options&&options.synchronous,runWhen:options?options.runWhen:null}),this.handlers.length-1}eject(id){this.handlers[id]&&(this.handlers[id]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(fn){utils.forEach(this.handlers,(function(h){null!==h&&fn(h)}))}},defaults_transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},browser={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:helpers_AxiosURLSearchParams,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv="undefined"!=typeof window&&"undefined"!=typeof document,hasStandardBrowserEnv=(product="undefined"!=typeof navigator&&navigator.product,hasBrowserEnv&&["ReactNative","NativeScript","NS"].indexOf(product)<0);var product;const hasStandardBrowserWebWorkerEnv="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,origin=hasBrowserEnv&&window.location.href||"http://localhost",platform={...common_utils_namespaceObject,...browser};const helpers_formDataToJSON=function(formData){function buildPath(path,value,target,index){let name=path[index++];if("__proto__"===name)return!0;const isNumericKey=Number.isFinite(+name),isLast=index>=path.length;if(name=!name&&utils.isArray(target)?target.length:name,isLast)return utils.hasOwnProp(target,name)?target[name]=[target[name],value]:target[name]=value,!isNumericKey;target[name]&&utils.isObject(target[name])||(target[name]=[]);return buildPath(path,value,target[name],index)&&utils.isArray(target[name])&&(target[name]=function(arr){const obj={},keys=Object.keys(arr);let i;const len=keys.length;let key;for(i=0;i<len;i++)key=keys[i],obj[key]=arr[key];return obj}(target[name])),!isNumericKey}if(utils.isFormData(formData)&&utils.isFunction(formData.entries)){const obj={};return utils.forEachEntry(formData,((name,value)=>{buildPath(function(name){return utils.matchAll(/\w+|\[(\w*)]/g,name).map((match=>"[]"===match[0]?"":match[1]||match[0]))}(name),value,obj,0)})),obj}return null};const defaults={transitional:defaults_transitional,adapter:["xhr","http","fetch"],transformRequest:[function(data,headers){const contentType=headers.getContentType()||"",hasJSONContentType=contentType.indexOf("application/json")>-1,isObjectPayload=utils.isObject(data);isObjectPayload&&utils.isHTMLForm(data)&&(data=new FormData(data));if(utils.isFormData(data))return hasJSONContentType?JSON.stringify(helpers_formDataToJSON(data)):data;if(utils.isArrayBuffer(data)||utils.isBuffer(data)||utils.isStream(data)||utils.isFile(data)||utils.isBlob(data)||utils.isReadableStream(data))return data;if(utils.isArrayBufferView(data))return data.buffer;if(utils.isURLSearchParams(data))return headers.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),data.toString();let isFileList;if(isObjectPayload){if(contentType.indexOf("application/x-www-form-urlencoded")>-1)return function(data,options){return helpers_toFormData(data,new platform.classes.URLSearchParams,Object.assign({visitor:function(value,key,path,helpers){return platform.isNode&&utils.isBuffer(value)?(this.append(key,value.toString("base64")),!1):helpers.defaultVisitor.apply(this,arguments)}},options))}(data,this.formSerializer).toString();if((isFileList=utils.isFileList(data))||contentType.indexOf("multipart/form-data")>-1){const _FormData=this.env&&this.env.FormData;return helpers_toFormData(isFileList?{"files[]":data}:data,_FormData&&new _FormData,this.formSerializer)}}return isObjectPayload||hasJSONContentType?(headers.setContentType("application/json",!1),function(rawValue,parser,encoder){if(utils.isString(rawValue))try{return(parser||JSON.parse)(rawValue),utils.trim(rawValue)}catch(e){if("SyntaxError"!==e.name)throw e}return(encoder||JSON.stringify)(rawValue)}(data)):data}],transformResponse:[function(data){const transitional=this.transitional||defaults.transitional,forcedJSONParsing=transitional&&transitional.forcedJSONParsing,JSONRequested="json"===this.responseType;if(utils.isResponse(data)||utils.isReadableStream(data))return data;if(data&&utils.isString(data)&&(forcedJSONParsing&&!this.responseType||JSONRequested)){const strictJSONParsing=!(transitional&&transitional.silentJSONParsing)&&JSONRequested;try{return JSON.parse(data)}catch(e){if(strictJSONParsing){if("SyntaxError"===e.name)throw core_AxiosError.from(e,core_AxiosError.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return data}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(status){return status>=200&&status<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils.forEach(["delete","get","head","post","put","patch"],(method=>{defaults.headers[method]={}}));const lib_defaults=defaults,ignoreDuplicateOf=utils.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$internals=Symbol("internals");function normalizeHeader(header){return header&&String(header).trim().toLowerCase()}function normalizeValue(value){return!1===value||null==value?value:utils.isArray(value)?value.map(normalizeValue):String(value)}function matchHeaderValue(context,value,header,filter,isHeaderNameFilter){return utils.isFunction(filter)?filter.call(this,value,header):(isHeaderNameFilter&&(value=header),utils.isString(value)?utils.isString(filter)?-1!==value.indexOf(filter):utils.isRegExp(filter)?filter.test(value):void 0:void 0)}class AxiosHeaders{constructor(headers){headers&&this.set(headers)}set(header,valueOrRewrite,rewrite){const self=this;function setHeader(_value,_header,_rewrite){const lHeader=normalizeHeader(_header);if(!lHeader)throw new Error("header name must be a non-empty string");const key=utils.findKey(self,lHeader);(!key||void 0===self[key]||!0===_rewrite||void 0===_rewrite&&!1!==self[key])&&(self[key||_header]=normalizeValue(_value))}const setHeaders=(headers,_rewrite)=>utils.forEach(headers,((_value,_header)=>setHeader(_value,_header,_rewrite)));if(utils.isPlainObject(header)||header instanceof this.constructor)setHeaders(header,valueOrRewrite);else if(utils.isString(header)&&(header=header.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(header.trim()))setHeaders((rawHeaders=>{const parsed={};let key,val,i;return rawHeaders&&rawHeaders.split("\n").forEach((function(line){i=line.indexOf(":"),key=line.substring(0,i).trim().toLowerCase(),val=line.substring(i+1).trim(),!key||parsed[key]&&ignoreDuplicateOf[key]||("set-cookie"===key?parsed[key]?parsed[key].push(val):parsed[key]=[val]:parsed[key]=parsed[key]?parsed[key]+", "+val:val)})),parsed})(header),valueOrRewrite);else if(utils.isHeaders(header))for(const[key,value]of header.entries())setHeader(value,key,rewrite);else null!=header&&setHeader(valueOrRewrite,header,rewrite);return this}get(header,parser){if(header=normalizeHeader(header)){const key=utils.findKey(this,header);if(key){const value=this[key];if(!parser)return value;if(!0===parser)return function(str){const tokens=Object.create(null),tokensRE=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let match;for(;match=tokensRE.exec(str);)tokens[match[1]]=match[2];return tokens}(value);if(utils.isFunction(parser))return parser.call(this,value,key);if(utils.isRegExp(parser))return parser.exec(value);throw new TypeError("parser must be boolean|regexp|function")}}}has(header,matcher){if(header=normalizeHeader(header)){const key=utils.findKey(this,header);return!(!key||void 0===this[key]||matcher&&!matchHeaderValue(0,this[key],key,matcher))}return!1}delete(header,matcher){const self=this;let deleted=!1;function deleteHeader(_header){if(_header=normalizeHeader(_header)){const key=utils.findKey(self,_header);!key||matcher&&!matchHeaderValue(0,self[key],key,matcher)||(delete self[key],deleted=!0)}}return utils.isArray(header)?header.forEach(deleteHeader):deleteHeader(header),deleted}clear(matcher){const keys=Object.keys(this);let i=keys.length,deleted=!1;for(;i--;){const key=keys[i];matcher&&!matchHeaderValue(0,this[key],key,matcher,!0)||(delete this[key],deleted=!0)}return deleted}normalize(format){const self=this,headers={};return utils.forEach(this,((value,header)=>{const key=utils.findKey(headers,header);if(key)return self[key]=normalizeValue(value),void delete self[header];const normalized=format?function(header){return header.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((w,char,str)=>char.toUpperCase()+str))}(header):String(header).trim();normalized!==header&&delete self[header],self[normalized]=normalizeValue(value),headers[normalized]=!0})),this}concat(...targets){return this.constructor.concat(this,...targets)}toJSON(asStrings){const obj=Object.create(null);return utils.forEach(this,((value,header)=>{null!=value&&!1!==value&&(obj[header]=asStrings&&utils.isArray(value)?value.join(", "):value)})),obj}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([header,value])=>header+": "+value)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(thing){return thing instanceof this?thing:new this(thing)}static concat(first,...targets){const computed=new this(first);return targets.forEach((target=>computed.set(target))),computed}static accessor(header){const accessors=(this[$internals]=this[$internals]={accessors:{}}).accessors,prototype=this.prototype;function defineAccessor(_header){const lHeader=normalizeHeader(_header);accessors[lHeader]||(!function(obj,header){const accessorName=utils.toCamelCase(" "+header);["get","set","has"].forEach((methodName=>{Object.defineProperty(obj,methodName+accessorName,{value:function(arg1,arg2,arg3){return this[methodName].call(this,header,arg1,arg2,arg3)},configurable:!0})}))}(prototype,_header),accessors[lHeader]=!0)}return utils.isArray(header)?header.forEach(defineAccessor):defineAccessor(header),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),utils.reduceDescriptors(AxiosHeaders.prototype,(({value},key)=>{let mapped=key[0].toUpperCase()+key.slice(1);return{get:()=>value,set(headerValue){this[mapped]=headerValue}}})),utils.freezeMethods(AxiosHeaders);const core_AxiosHeaders=AxiosHeaders;function transformData(fns,response){const config=this||lib_defaults,context=response||config,headers=core_AxiosHeaders.from(context.headers);let data=context.data;return utils.forEach(fns,(function(fn){data=fn.call(config,data,headers.normalize(),response?response.status:void 0)})),headers.normalize(),data}function isCancel(value){return!(!value||!value.__CANCEL__)}function CanceledError(message,config,request){core_AxiosError.call(this,null==message?"canceled":message,core_AxiosError.ERR_CANCELED,config,request),this.name="CanceledError"}utils.inherits(CanceledError,core_AxiosError,{__CANCEL__:!0});const cancel_CanceledError=CanceledError;function settle(resolve,reject,response){const validateStatus=response.config.validateStatus;response.status&&validateStatus&&!validateStatus(response.status)?reject(new core_AxiosError("Request failed with status code "+response.status,[core_AxiosError.ERR_BAD_REQUEST,core_AxiosError.ERR_BAD_RESPONSE][Math.floor(response.status/100)-4],response.config,response.request,response)):resolve(response)}const helpers_speedometer=function(samplesCount,min){samplesCount=samplesCount||10;const bytes=new Array(samplesCount),timestamps=new Array(samplesCount);let firstSampleTS,head=0,tail=0;return min=void 0!==min?min:1e3,function(chunkLength){const now=Date.now(),startedAt=timestamps[tail];firstSampleTS||(firstSampleTS=now),bytes[head]=chunkLength,timestamps[head]=now;let i=tail,bytesCount=0;for(;i!==head;)bytesCount+=bytes[i++],i%=samplesCount;if(head=(head+1)%samplesCount,head===tail&&(tail=(tail+1)%samplesCount),now-firstSampleTS<min)return;const passed=startedAt&&now-startedAt;return passed?Math.round(1e3*bytesCount/passed):void 0}};const helpers_throttle=function(fn,freq){let lastArgs,timer,timestamp=0,threshold=1e3/freq;const invoke=(args,now=Date.now())=>{timestamp=now,lastArgs=null,timer&&(clearTimeout(timer),timer=null),fn.apply(null,args)};return[(...args)=>{const now=Date.now(),passed=now-timestamp;passed>=threshold?invoke(args,now):(lastArgs=args,timer||(timer=setTimeout((()=>{timer=null,invoke(lastArgs)}),threshold-passed)))},()=>lastArgs&&invoke(lastArgs)]},progressEventReducer=(listener,isDownloadStream,freq=3)=>{let bytesNotified=0;const _speedometer=helpers_speedometer(50,250);return helpers_throttle((e=>{const loaded=e.loaded,total=e.lengthComputable?e.total:void 0,progressBytes=loaded-bytesNotified,rate=_speedometer(progressBytes);bytesNotified=loaded;listener({loaded,total,progress:total?loaded/total:void 0,bytes:progressBytes,rate:rate||void 0,estimated:rate&&total&&loaded<=total?(total-loaded)/rate:void 0,event:e,lengthComputable:null!=total,[isDownloadStream?"download":"upload"]:!0})}),freq)},progressEventDecorator=(total,throttled)=>{const lengthComputable=null!=total;return[loaded=>throttled[0]({lengthComputable,total,loaded}),throttled[1]]},asyncDecorator=fn=>(...args)=>utils.asap((()=>fn(...args))),isURLSameOrigin=platform.hasStandardBrowserEnv?function(){const msie=/(msie|trident)/i.test(navigator.userAgent),urlParsingNode=document.createElement("a");let originURL;function resolveURL(url){let href=url;return msie&&(urlParsingNode.setAttribute("href",href),href=urlParsingNode.href),urlParsingNode.setAttribute("href",href),{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:"/"===urlParsingNode.pathname.charAt(0)?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}return originURL=resolveURL(window.location.href),function(requestURL){const parsed=utils.isString(requestURL)?resolveURL(requestURL):requestURL;return parsed.protocol===originURL.protocol&&parsed.host===originURL.host}}():function(){return!0},cookies=platform.hasStandardBrowserEnv?{write(name,value,expires,path,domain,secure){const cookie=[name+"="+encodeURIComponent(value)];utils.isNumber(expires)&&cookie.push("expires="+new Date(expires).toGMTString()),utils.isString(path)&&cookie.push("path="+path),utils.isString(domain)&&cookie.push("domain="+domain),!0===secure&&cookie.push("secure"),document.cookie=cookie.join("; ")},read(name){const match=document.cookie.match(new RegExp("(^|;\\s*)("+name+")=([^;]*)"));return match?decodeURIComponent(match[3]):null},remove(name){this.write(name,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function buildFullPath(baseURL,requestedURL){return baseURL&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(requestedURL)?function(baseURL,relativeURL){return relativeURL?baseURL.replace(/\/?\/$/,"")+"/"+relativeURL.replace(/^\/+/,""):baseURL}(baseURL,requestedURL):requestedURL}const headersToObject=thing=>thing instanceof core_AxiosHeaders?{...thing}:thing;function mergeConfig(config1,config2){config2=config2||{};const config={};function getMergedValue(target,source,caseless){return utils.isPlainObject(target)&&utils.isPlainObject(source)?utils.merge.call({caseless},target,source):utils.isPlainObject(source)?utils.merge({},source):utils.isArray(source)?source.slice():source}function mergeDeepProperties(a,b,caseless){return utils.isUndefined(b)?utils.isUndefined(a)?void 0:getMergedValue(void 0,a,caseless):getMergedValue(a,b,caseless)}function valueFromConfig2(a,b){if(!utils.isUndefined(b))return getMergedValue(void 0,b)}function defaultToConfig2(a,b){return utils.isUndefined(b)?utils.isUndefined(a)?void 0:getMergedValue(void 0,a):getMergedValue(void 0,b)}function mergeDirectKeys(a,b,prop){return prop in config2?getMergedValue(a,b):prop in config1?getMergedValue(void 0,a):void 0}const mergeMap={url:valueFromConfig2,method:valueFromConfig2,data:valueFromConfig2,baseURL:defaultToConfig2,transformRequest:defaultToConfig2,transformResponse:defaultToConfig2,paramsSerializer:defaultToConfig2,timeout:defaultToConfig2,timeoutMessage:defaultToConfig2,withCredentials:defaultToConfig2,withXSRFToken:defaultToConfig2,adapter:defaultToConfig2,responseType:defaultToConfig2,xsrfCookieName:defaultToConfig2,xsrfHeaderName:defaultToConfig2,onUploadProgress:defaultToConfig2,onDownloadProgress:defaultToConfig2,decompress:defaultToConfig2,maxContentLength:defaultToConfig2,maxBodyLength:defaultToConfig2,beforeRedirect:defaultToConfig2,transport:defaultToConfig2,httpAgent:defaultToConfig2,httpsAgent:defaultToConfig2,cancelToken:defaultToConfig2,socketPath:defaultToConfig2,responseEncoding:defaultToConfig2,validateStatus:mergeDirectKeys,headers:(a,b)=>mergeDeepProperties(headersToObject(a),headersToObject(b),!0)};return utils.forEach(Object.keys(Object.assign({},config1,config2)),(function(prop){const merge=mergeMap[prop]||mergeDeepProperties,configValue=merge(config1[prop],config2[prop],prop);utils.isUndefined(configValue)&&merge!==mergeDirectKeys||(config[prop]=configValue)})),config}const resolveConfig=config=>{const newConfig=mergeConfig({},config);let contentType,{data,withXSRFToken,xsrfHeaderName,xsrfCookieName,headers,auth}=newConfig;if(newConfig.headers=headers=core_AxiosHeaders.from(headers),newConfig.url=buildURL(buildFullPath(newConfig.baseURL,newConfig.url),config.params,config.paramsSerializer),auth&&headers.set("Authorization","Basic "+btoa((auth.username||"")+":"+(auth.password?unescape(encodeURIComponent(auth.password)):""))),utils.isFormData(data))if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)headers.setContentType(void 0);else if(!1!==(contentType=headers.getContentType())){const[type,...tokens]=contentType?contentType.split(";").map((token=>token.trim())).filter(Boolean):[];headers.setContentType([type||"multipart/form-data",...tokens].join("; "))}if(platform.hasStandardBrowserEnv&&(withXSRFToken&&utils.isFunction(withXSRFToken)&&(withXSRFToken=withXSRFToken(newConfig)),withXSRFToken||!1!==withXSRFToken&&isURLSameOrigin(newConfig.url))){const xsrfValue=xsrfHeaderName&&xsrfCookieName&&cookies.read(xsrfCookieName);xsrfValue&&headers.set(xsrfHeaderName,xsrfValue)}return newConfig},xhr="undefined"!=typeof XMLHttpRequest&&function(config){return new Promise((function(resolve,reject){const _config=resolveConfig(config);let requestData=_config.data;const requestHeaders=core_AxiosHeaders.from(_config.headers).normalize();let onCanceled,uploadThrottled,downloadThrottled,flushUpload,flushDownload,{responseType,onUploadProgress,onDownloadProgress}=_config;function done(){flushUpload&&flushUpload(),flushDownload&&flushDownload(),_config.cancelToken&&_config.cancelToken.unsubscribe(onCanceled),_config.signal&&_config.signal.removeEventListener("abort",onCanceled)}let request=new XMLHttpRequest;function onloadend(){if(!request)return;const responseHeaders=core_AxiosHeaders.from("getAllResponseHeaders"in request&&request.getAllResponseHeaders());settle((function(value){resolve(value),done()}),(function(err){reject(err),done()}),{data:responseType&&"text"!==responseType&&"json"!==responseType?request.response:request.responseText,status:request.status,statusText:request.statusText,headers:responseHeaders,config,request}),request=null}request.open(_config.method.toUpperCase(),_config.url,!0),request.timeout=_config.timeout,"onloadend"in request?request.onloadend=onloadend:request.onreadystatechange=function(){request&&4===request.readyState&&(0!==request.status||request.responseURL&&0===request.responseURL.indexOf("file:"))&&setTimeout(onloadend)},request.onabort=function(){request&&(reject(new core_AxiosError("Request aborted",core_AxiosError.ECONNABORTED,config,request)),request=null)},request.onerror=function(){reject(new core_AxiosError("Network Error",core_AxiosError.ERR_NETWORK,config,request)),request=null},request.ontimeout=function(){let timeoutErrorMessage=_config.timeout?"timeout of "+_config.timeout+"ms exceeded":"timeout exceeded";const transitional=_config.transitional||defaults_transitional;_config.timeoutErrorMessage&&(timeoutErrorMessage=_config.timeoutErrorMessage),reject(new core_AxiosError(timeoutErrorMessage,transitional.clarifyTimeoutError?core_AxiosError.ETIMEDOUT:core_AxiosError.ECONNABORTED,config,request)),request=null},void 0===requestData&&requestHeaders.setContentType(null),"setRequestHeader"in request&&utils.forEach(requestHeaders.toJSON(),(function(val,key){request.setRequestHeader(key,val)})),utils.isUndefined(_config.withCredentials)||(request.withCredentials=!!_config.withCredentials),responseType&&"json"!==responseType&&(request.responseType=_config.responseType),onDownloadProgress&&([downloadThrottled,flushDownload]=progressEventReducer(onDownloadProgress,!0),request.addEventListener("progress",downloadThrottled)),onUploadProgress&&request.upload&&([uploadThrottled,flushUpload]=progressEventReducer(onUploadProgress),request.upload.addEventListener("progress",uploadThrottled),request.upload.addEventListener("loadend",flushUpload)),(_config.cancelToken||_config.signal)&&(onCanceled=cancel=>{request&&(reject(!cancel||cancel.type?new cancel_CanceledError(null,config,request):cancel),request.abort(),request=null)},_config.cancelToken&&_config.cancelToken.subscribe(onCanceled),_config.signal&&(_config.signal.aborted?onCanceled():_config.signal.addEventListener("abort",onCanceled)));const protocol=function(url){const match=/^([-+\w]{1,25})(:?\/\/|:)/.exec(url);return match&&match[1]||""}(_config.url);protocol&&-1===platform.protocols.indexOf(protocol)?reject(new core_AxiosError("Unsupported protocol "+protocol+":",core_AxiosError.ERR_BAD_REQUEST,config)):request.send(requestData||null)}))},helpers_composeSignals=(signals,timeout)=>{let aborted,controller=new AbortController;const onabort=function(cancel){if(!aborted){aborted=!0,unsubscribe();const err=cancel instanceof Error?cancel:this.reason;controller.abort(err instanceof core_AxiosError?err:new cancel_CanceledError(err instanceof Error?err.message:err))}};let timer=timeout&&setTimeout((()=>{onabort(new core_AxiosError(`timeout ${timeout} of ms exceeded`,core_AxiosError.ETIMEDOUT))}),timeout);const unsubscribe=()=>{signals&&(timer&&clearTimeout(timer),timer=null,signals.forEach((signal=>{signal&&(signal.removeEventListener?signal.removeEventListener("abort",onabort):signal.unsubscribe(onabort))})),signals=null)};signals.forEach((signal=>signal&&signal.addEventListener&&signal.addEventListener("abort",onabort)));const{signal}=controller;return signal.unsubscribe=unsubscribe,[signal,()=>{timer&&clearTimeout(timer),timer=null}]},streamChunk=function*(chunk,chunkSize){let len=chunk.byteLength;if(!chunkSize||len<chunkSize)return void(yield chunk);let end,pos=0;for(;pos<len;)end=pos+chunkSize,yield chunk.slice(pos,end),pos=end},trackStream=(stream,chunkSize,onProgress,onFinish,encode)=>{const iterator=async function*(iterable,chunkSize,encode){for await(const chunk of iterable)yield*streamChunk(ArrayBuffer.isView(chunk)?chunk:await encode(String(chunk)),chunkSize)}(stream,chunkSize,encode);let done,bytes=0,_onFinish=e=>{done||(done=!0,onFinish&&onFinish(e))};return new ReadableStream({async pull(controller){try{const{done,value}=await iterator.next();if(done)return _onFinish(),void controller.close();let len=value.byteLength;if(onProgress){let loadedBytes=bytes+=len;onProgress(loadedBytes)}controller.enqueue(new Uint8Array(value))}catch(err){throw _onFinish(err),err}},cancel:reason=>(_onFinish(reason),iterator.return())},{highWaterMark:2})},isFetchSupported="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,isReadableStreamSupported=isFetchSupported&&"function"==typeof ReadableStream,encodeText=isFetchSupported&&("function"==typeof TextEncoder?(encoder=new TextEncoder,str=>encoder.encode(str)):async str=>new Uint8Array(await new Response(str).arrayBuffer()));var encoder;const test=(fn,...args)=>{try{return!!fn(...args)}catch(e){return!1}},supportsRequestStream=isReadableStreamSupported&&test((()=>{let duplexAccessed=!1;const hasContentType=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return duplexAccessed=!0,"half"}}).headers.has("Content-Type");return duplexAccessed&&!hasContentType})),supportsResponseStream=isReadableStreamSupported&&test((()=>utils.isReadableStream(new Response("").body))),resolvers={stream:supportsResponseStream&&(res=>res.body)};var res;isFetchSupported&&(res=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((type=>{!resolvers[type]&&(resolvers[type]=utils.isFunction(res[type])?res=>res[type]():(_,config)=>{throw new core_AxiosError(`Response type '${type}' is not supported`,core_AxiosError.ERR_NOT_SUPPORT,config)})})));const resolveBodyLength=async(headers,body)=>{const length=utils.toFiniteNumber(headers.getContentLength());return null==length?(async body=>null==body?0:utils.isBlob(body)?body.size:utils.isSpecCompliantForm(body)?(await new Request(body).arrayBuffer()).byteLength:utils.isArrayBufferView(body)||utils.isArrayBuffer(body)?body.byteLength:(utils.isURLSearchParams(body)&&(body+=""),utils.isString(body)?(await encodeText(body)).byteLength:void 0))(body):length},knownAdapters={http:null,xhr,fetch:isFetchSupported&&(async config=>{let{url,method,data,signal,cancelToken,timeout,onDownloadProgress,onUploadProgress,responseType,headers,withCredentials="same-origin",fetchOptions}=resolveConfig(config);responseType=responseType?(responseType+"").toLowerCase():"text";let finished,request,[composedSignal,stopTimeout]=signal||cancelToken||timeout?helpers_composeSignals([signal,cancelToken],timeout):[];const onFinish=()=>{!finished&&setTimeout((()=>{composedSignal&&composedSignal.unsubscribe()})),finished=!0};let requestContentLength;try{if(onUploadProgress&&supportsRequestStream&&"get"!==method&&"head"!==method&&0!==(requestContentLength=await resolveBodyLength(headers,data))){let contentTypeHeader,_request=new Request(url,{method:"POST",body:data,duplex:"half"});if(utils.isFormData(data)&&(contentTypeHeader=_request.headers.get("content-type"))&&headers.setContentType(contentTypeHeader),_request.body){const[onProgress,flush]=progressEventDecorator(requestContentLength,progressEventReducer(asyncDecorator(onUploadProgress)));data=trackStream(_request.body,65536,onProgress,flush,encodeText)}}utils.isString(withCredentials)||(withCredentials=withCredentials?"include":"omit"),request=new Request(url,{...fetchOptions,signal:composedSignal,method:method.toUpperCase(),headers:headers.normalize().toJSON(),body:data,duplex:"half",credentials:withCredentials});let response=await fetch(request);const isStreamResponse=supportsResponseStream&&("stream"===responseType||"response"===responseType);if(supportsResponseStream&&(onDownloadProgress||isStreamResponse)){const options={};["status","statusText","headers"].forEach((prop=>{options[prop]=response[prop]}));const responseContentLength=utils.toFiniteNumber(response.headers.get("content-length")),[onProgress,flush]=onDownloadProgress&&progressEventDecorator(responseContentLength,progressEventReducer(asyncDecorator(onDownloadProgress),!0))||[];response=new Response(trackStream(response.body,65536,onProgress,(()=>{flush&&flush(),isStreamResponse&&onFinish()}),encodeText),options)}responseType=responseType||"text";let responseData=await resolvers[utils.findKey(resolvers,responseType)||"text"](response,config);return!isStreamResponse&&onFinish(),stopTimeout&&stopTimeout(),await new Promise(((resolve,reject)=>{settle(resolve,reject,{data:responseData,headers:core_AxiosHeaders.from(response.headers),status:response.status,statusText:response.statusText,config,request})}))}catch(err){if(onFinish(),err&&"TypeError"===err.name&&/fetch/i.test(err.message))throw Object.assign(new core_AxiosError("Network Error",core_AxiosError.ERR_NETWORK,config,request),{cause:err.cause||err});throw core_AxiosError.from(err,err&&err.code,config,request)}})};utils.forEach(knownAdapters,((fn,value)=>{if(fn){try{Object.defineProperty(fn,"name",{value})}catch(e){}Object.defineProperty(fn,"adapterName",{value})}}));const renderReason=reason=>`- ${reason}`,isResolvedHandle=adapter=>utils.isFunction(adapter)||null===adapter||!1===adapter,adapters_getAdapter=adapters=>{adapters=utils.isArray(adapters)?adapters:[adapters];const{length}=adapters;let nameOrAdapter,adapter;const rejectedReasons={};for(let i=0;i<length;i++){let id;if(nameOrAdapter=adapters[i],adapter=nameOrAdapter,!isResolvedHandle(nameOrAdapter)&&(adapter=knownAdapters[(id=String(nameOrAdapter)).toLowerCase()],void 0===adapter))throw new core_AxiosError(`Unknown adapter '${id}'`);if(adapter)break;rejectedReasons[id||"#"+i]=adapter}if(!adapter){const reasons=Object.entries(rejectedReasons).map((([id,state])=>`adapter ${id} `+(!1===state?"is not supported by the environment":"is not available in the build")));let s=length?reasons.length>1?"since :\n"+reasons.map(renderReason).join("\n"):" "+renderReason(reasons[0]):"as no adapter specified";throw new core_AxiosError("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return adapter};function throwIfCancellationRequested(config){if(config.cancelToken&&config.cancelToken.throwIfRequested(),config.signal&&config.signal.aborted)throw new cancel_CanceledError(null,config)}function dispatchRequest(config){throwIfCancellationRequested(config),config.headers=core_AxiosHeaders.from(config.headers),config.data=transformData.call(config,config.transformRequest),-1!==["post","put","patch"].indexOf(config.method)&&config.headers.setContentType("application/x-www-form-urlencoded",!1);return adapters_getAdapter(config.adapter||lib_defaults.adapter)(config).then((function(response){return throwIfCancellationRequested(config),response.data=transformData.call(config,config.transformResponse,response),response.headers=core_AxiosHeaders.from(response.headers),response}),(function(reason){return isCancel(reason)||(throwIfCancellationRequested(config),reason&&reason.response&&(reason.response.data=transformData.call(config,config.transformResponse,reason.response),reason.response.headers=core_AxiosHeaders.from(reason.response.headers))),Promise.reject(reason)}))}const validators={};["object","boolean","number","function","string","symbol"].forEach(((type,i)=>{validators[type]=function(thing){return typeof thing===type||"a"+(i<1?"n ":" ")+type}}));const deprecatedWarnings={};validators.transitional=function(validator,version,message){function formatMessage(opt,desc){return"[Axios v1.7.4] Transitional option '"+opt+"'"+desc+(message?". "+message:"")}return(value,opt,opts)=>{if(!1===validator)throw new core_AxiosError(formatMessage(opt," has been removed"+(version?" in "+version:"")),core_AxiosError.ERR_DEPRECATED);return version&&!deprecatedWarnings[opt]&&(deprecatedWarnings[opt]=!0,console.warn(formatMessage(opt," has been deprecated since v"+version+" and will be removed in the near future"))),!validator||validator(value,opt,opts)}};const validator={assertOptions:function(options,schema,allowUnknown){if("object"!=typeof options)throw new core_AxiosError("options must be an object",core_AxiosError.ERR_BAD_OPTION_VALUE);const keys=Object.keys(options);let i=keys.length;for(;i-- >0;){const opt=keys[i],validator=schema[opt];if(validator){const value=options[opt],result=void 0===value||validator(value,opt,options);if(!0!==result)throw new core_AxiosError("option "+opt+" must be "+result,core_AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==allowUnknown)throw new core_AxiosError("Unknown option "+opt,core_AxiosError.ERR_BAD_OPTION)}},validators},Axios_validators=validator.validators;class Axios{constructor(instanceConfig){this.defaults=instanceConfig,this.interceptors={request:new core_InterceptorManager,response:new core_InterceptorManager}}async request(configOrUrl,config){try{return await this._request(configOrUrl,config)}catch(err){if(err instanceof Error){let dummy;Error.captureStackTrace?Error.captureStackTrace(dummy={}):dummy=new Error;const stack=dummy.stack?dummy.stack.replace(/^.+\n/,""):"";try{err.stack?stack&&!String(err.stack).endsWith(stack.replace(/^.+\n.+\n/,""))&&(err.stack+="\n"+stack):err.stack=stack}catch(e){}}throw err}}_request(configOrUrl,config){"string"==typeof configOrUrl?(config=config||{}).url=configOrUrl:config=configOrUrl||{},config=mergeConfig(this.defaults,config);const{transitional,paramsSerializer,headers}=config;void 0!==transitional&&validator.assertOptions(transitional,{silentJSONParsing:Axios_validators.transitional(Axios_validators.boolean),forcedJSONParsing:Axios_validators.transitional(Axios_validators.boolean),clarifyTimeoutError:Axios_validators.transitional(Axios_validators.boolean)},!1),null!=paramsSerializer&&(utils.isFunction(paramsSerializer)?config.paramsSerializer={serialize:paramsSerializer}:validator.assertOptions(paramsSerializer,{encode:Axios_validators.function,serialize:Axios_validators.function},!0)),config.method=(config.method||this.defaults.method||"get").toLowerCase();let contextHeaders=headers&&utils.merge(headers.common,headers[config.method]);headers&&utils.forEach(["delete","get","head","post","put","patch","common"],(method=>{delete headers[method]})),config.headers=core_AxiosHeaders.concat(contextHeaders,headers);const requestInterceptorChain=[];let synchronousRequestInterceptors=!0;this.interceptors.request.forEach((function(interceptor){"function"==typeof interceptor.runWhen&&!1===interceptor.runWhen(config)||(synchronousRequestInterceptors=synchronousRequestInterceptors&&interceptor.synchronous,requestInterceptorChain.unshift(interceptor.fulfilled,interceptor.rejected))}));const responseInterceptorChain=[];let promise;this.interceptors.response.forEach((function(interceptor){responseInterceptorChain.push(interceptor.fulfilled,interceptor.rejected)}));let len,i=0;if(!synchronousRequestInterceptors){const chain=[dispatchRequest.bind(this),void 0];for(chain.unshift.apply(chain,requestInterceptorChain),chain.push.apply(chain,responseInterceptorChain),len=chain.length,promise=Promise.resolve(config);i<len;)promise=promise.then(chain[i++],chain[i++]);return promise}len=requestInterceptorChain.length;let newConfig=config;for(i=0;i<len;){const onFulfilled=requestInterceptorChain[i++],onRejected=requestInterceptorChain[i++];try{newConfig=onFulfilled(newConfig)}catch(error){onRejected.call(this,error);break}}try{promise=dispatchRequest.call(this,newConfig)}catch(error){return Promise.reject(error)}for(i=0,len=responseInterceptorChain.length;i<len;)promise=promise.then(responseInterceptorChain[i++],responseInterceptorChain[i++]);return promise}getUri(config){return buildURL(buildFullPath((config=mergeConfig(this.defaults,config)).baseURL,config.url),config.params,config.paramsSerializer)}}utils.forEach(["delete","get","head","options"],(function(method){Axios.prototype[method]=function(url,config){return this.request(mergeConfig(config||{},{method,url,data:(config||{}).data}))}})),utils.forEach(["post","put","patch"],(function(method){function generateHTTPMethod(isForm){return function(url,data,config){return this.request(mergeConfig(config||{},{method,headers:isForm?{"Content-Type":"multipart/form-data"}:{},url,data}))}}Axios.prototype[method]=generateHTTPMethod(),Axios.prototype[method+"Form"]=generateHTTPMethod(!0)}));const core_Axios=Axios;class CancelToken{constructor(executor){if("function"!=typeof executor)throw new TypeError("executor must be a function.");let resolvePromise;this.promise=new Promise((function(resolve){resolvePromise=resolve}));const token=this;this.promise.then((cancel=>{if(!token._listeners)return;let i=token._listeners.length;for(;i-- >0;)token._listeners[i](cancel);token._listeners=null})),this.promise.then=onfulfilled=>{let _resolve;const promise=new Promise((resolve=>{token.subscribe(resolve),_resolve=resolve})).then(onfulfilled);return promise.cancel=function(){token.unsubscribe(_resolve)},promise},executor((function(message,config,request){token.reason||(token.reason=new cancel_CanceledError(message,config,request),resolvePromise(token.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(listener){this.reason?listener(this.reason):this._listeners?this._listeners.push(listener):this._listeners=[listener]}unsubscribe(listener){if(!this._listeners)return;const index=this._listeners.indexOf(listener);-1!==index&&this._listeners.splice(index,1)}static source(){let cancel;return{token:new CancelToken((function(c){cancel=c})),cancel}}}const cancel_CancelToken=CancelToken;const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach((([key,value])=>{HttpStatusCode[value]=key}));const helpers_HttpStatusCode=HttpStatusCode;const axios=function createInstance(defaultConfig){const context=new core_Axios(defaultConfig),instance=bind(core_Axios.prototype.request,context);return utils.extend(instance,core_Axios.prototype,context,{allOwnKeys:!0}),utils.extend(instance,context,null,{allOwnKeys:!0}),instance.create=function(instanceConfig){return createInstance(mergeConfig(defaultConfig,instanceConfig))},instance}(lib_defaults);axios.Axios=core_Axios,axios.CanceledError=cancel_CanceledError,axios.CancelToken=cancel_CancelToken,axios.isCancel=isCancel,axios.VERSION="1.7.4",axios.toFormData=helpers_toFormData,axios.AxiosError=core_AxiosError,axios.Cancel=axios.CanceledError,axios.all=function(promises){return Promise.all(promises)},axios.spread=function(callback){return function(arr){return callback.apply(null,arr)}},axios.isAxiosError=function(payload){return utils.isObject(payload)&&!0===payload.isAxiosError},axios.mergeConfig=mergeConfig,axios.AxiosHeaders=core_AxiosHeaders,axios.formToJSON=thing=>helpers_formDataToJSON(utils.isHTMLForm(thing)?new FormData(thing):thing),axios.getAdapter=adapters_getAdapter,axios.HttpStatusCode=helpers_HttpStatusCode,axios.default=axios;const lib_axios=axios;class KoboldCpp{constructor(){this.args={max_context_length:16384,max_length:20,prompt:"Hello",quiet:!0,rep_pen:1,rep_pen_range:0,rep_pen_slope:1,temperature:.1,tfs:1,top_a:0,top_k:100,top_p:.9,typical:1,stop_sequence:["###","### Instruction:","### Response:"]}}async performQuery(context,query){this.args.prompt=this.createContext(context,query);const url="http://localhost:5001/api/v1/generate",args=this.args,response=await lib_axios.post(url,args).catch((function(error){var argscopy=args;argscopy.prompt="**REDACTED**",error.response?console.log(`Error response ${error.response.status} from POST to ${url} with args ${JSON.stringify(argscopy)}`):error.request?console.log(`Request error performing POST to ${url} with args ${JSON.stringify(argscopy)}`):console.log(`Unknown error performing POST to ${url} with args ${JSON.stringify(argscopy)}`)}));return await this.getQueryResponse(response)}createContext(context,query){var result="\n### Instruction:\nYou are taking the role of a copy editor for fiction writing. I am going to show you a role-play chat transcript and then I will ask you a series of questions. Please answer each question without prejudice or bias. Keep answers brief and do not add additional commentary. Here is the transcript:\n\n";return result+=context+"\n\n",result+="Please answer the following question(s) with a YES/NO and without further \n\n",result+=query+"\n\n",result+="### Response:\n"}async getQueryResponse(response){if(response){const results=response.data.results,generatedText=results.length>0?results[0].text:"";if(generatedText.startsWith("YES"))return"YES";if(generatedText.startsWith("NO"))return"NO"}return"UNKNOWN"}}const MODULE_NAME="third-party/Extension-BehaviorTree",settings={enabled:!1,chatDepth:0,executionFrequency:1,executionCounter:1,chatQueryLength:30};let btree=null,lastResponse="",lastChatString="";function updateCounter(newValue){const{saveSettingsDebounced}=SillyTavern.getContext();settings.executionCounter=newValue,$("#bt-counter").val(settings.executionCounter),saveSettingsDebounced()}window.BehaviorTree=async coreChat=>{const{setExtensionPrompt,substituteParams}=SillyTavern.getContext();if(!settings.enabled)return;if(null==btree)return;if(1!=settings.executionCounter)return void updateCounter(settings.executionCounter-1);updateCounter(settings.executionFrequency);const chatString=function(coreChat){let chatString="";const maxChatLength=Math.min(settings.chatQueryLength,coreChat.length);for(let i=coreChat.length-maxChatLength;i<coreChat.length;i++){const message=coreChat[i];chatString+=`${message.name}: ${message.mes}\n`}return chatString}(coreChat);if(lastResponse&&lastChatString&&chatString===lastChatString)return console.log(`Behavior Tree using cached result:\n${lastResponse}`),void setExtensionPrompt(MODULE_NAME,lastResponse,1,settings.chatDepth);console.log("Running Behavior Tree");let response=await async function(chatString){try{return btree.reset(),btree.setContext(chatString),btree.step(),await btree.getResponse()}catch{return console.error("ERROR executing BehaviorTree"),""}}(chatString);response=substituteParams(response),console.log(`Behavior Tree result:\n${response}`),lastChatString=chatString,lastResponse=response,setExtensionPrompt(MODULE_NAME,response,1,settings.chatDepth)},jQuery((async()=>{const{extensionSettings,renderExtensionTemplateAsync,saveSettingsDebounced,substituteParams}=SillyTavern.getContext();console.log("BehaviorTree started"),extensionSettings.behaviortree||(extensionSettings.behaviortree=settings),Object.assign(settings,extensionSettings.behaviortree);$(document.getElementById("behaviortree_container")??document.getElementById("extensions_settings2")).append(await renderExtensionTemplateAsync(MODULE_NAME,"src/settings")),$("#bt_enabled").prop("checked",settings.enabled).on("input",(()=>{settings.enabled=$("#bt_enabled").prop("checked"),Object.assign(extensionSettings.behaviortree,settings),saveSettingsDebounced()})),$("#bt-chat-depth").val(settings.chatDepth).on("input",(()=>{settings.chatDepth=Number($("#bt-chat-depth").val()),settings.chatDepth<1?$("#bt-parameter-warning").show():$("#bt-parameter-warning").hide(),Object.assign(extensionSettings.behaviortree,settings),saveSettingsDebounced()})),$("#bt-execution-frequency").val(settings.executionFrequency).on("input",(()=>{settings.executionFrequency=Number($("#bt-execution-frequency").val()),settings.executionCounter=Math.min(settings.executionCounter,settings.executionFrequency),$("#bt-counter").val(settings.executionCounter),Object.assign(extensionSettings.behaviortree,settings),saveSettingsDebounced()})),$("#bt-counter").val(settings.executionCounter).on("input",(()=>{settings.executionCounter=Number($("#bt-counter").val()),Object.assign(extensionSettings.behaviortree,settings),saveSettingsDebounced()})),$("#bt-chat-length").val(settings.chatQueryLength).on("input",(()=>{settings.chatQueryLength=Number($("#bt-chat-length").val()),Object.assign(extensionSettings.behaviortree,settings),saveSettingsDebounced()})),settings.chatDepth<1?$("#bt-parameter-warning").show():$("#bt-parameter-warning").hide(),btree=new AsyncBehaviorTree(new KoboldCpp,"./testtree.json",substituteParams)}))})();